(self.webpackChunkgatsby_test=self.webpackChunkgatsby_test||[]).push([[921],{78531:function(e,t,n){"use strict";n.r(t);var a=n(85061),r=n(92137),i=n(87757),l=n.n(i),o=n(67294),s=n(96667),c=n(47798),u=n(80838),g=n(83332),m=n(44005),d=n(90058),f=n(1097),p=n(20458),v=n(80633),h=n(79312),b=n(85505),E=n(10920),y=n(27136),w=n(51474),k=n(49995),C=n(13508),Z=n(54657),P=n(4513),T=n(89952),N=n(65733),S=n(32253),x=n(9901),j=n(77447),I=n(88816),R=n(97849),A=n(9789),W=n(17710),F=n(59274),O=n(31261),D=n(8441),L=n(96531),U=n(48498),H=n(67253),M=n(74243),B=(n(74298),(0,E.Z)((function(e){return{root:{display:"flex",alignItems:"center"},wrapper:{position:"relative"},buttonSuccess:{backgroundColor:w.Z[500],"&:hover":{backgroundColor:w.Z[700]}},fabProgress:{color:w.Z[500],position:"absolute",top:-6,left:-6,zIndex:1},buttonProgress:{color:w.Z[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}})));t.default=function(){var e,t=o.useState(null),n=t[0],i=t[1],E=o.useState(null),w=(E[0],E[1],o.useState(null)),z=(w[0],w[1],o.useState({unclassified:[],positive:[],negative:[]})),$=z[0],G=z[1],_=o.useState(!1),X=_[0],q=_[1],J=o.useState(!1),K=J[0],Q=J[1],V=o.useState(!1),Y=V[0],ee=V[1],te=o.useState(!1),ne=te[0],ae=te[1],re=o.useState(!0),ie=re[0],le=re[1],oe=o.useState(!1),se=(oe[0],oe[1],o.useState(!1)),ce=se[0],ue=se[1],ge=o.useState(!1),me=ge[0],de=ge[1],fe=o.useState(!1),pe=fe[0],ve=fe[1],he=o.useState(!1),be=he[0],Ee=he[1],ye=o.useState(!1),we=ye[0],ke=ye[1],Ce=o.useState(null),Ze=Ce[0],Pe=Ce[1],Te=o.useState(null),Ne=Te[0],Se=Te[1],xe=o.useState(null),je=xe[0],Ie=xe[1],Re=o.useState([[0,0],[0,0]]),Ae=Re[0],We=Re[1],Fe=o.useState(null),Oe=Fe[0],De=Fe[1],Le=o.useState([]),Ue=Le[0],He=Le[1],Me=o.useState([]),Be=(Me[0],Me[1],o.useState(!1)),ze=Be[0],$e=Be[1],Ge=o.useState(null),_e=(Ge[0],Ge[1],o.useState([])),Xe=_e[0],qe=_e[1],Je=o.useState([]),Ke=Je[0],Qe=Je[1],Ve=o.useRef(),Ye=o.useRef(),et=o.useState(0),tt=et[0],nt=et[1],at=o.useState(!1),rt=at[0],it=at[1],lt=o.useState(!1),ot=lt[0],st=lt[1],ct=o.useState(W.Z),ut=ct[0],gt=ct[1],mt=o.useState(""),dt=mt[0],ft=mt[1],pt=o.useState(!1),vt=pt[0],ht=pt[1],bt=o.useState(""),Et=bt[0],yt=bt[1];o.useEffect((function(){var e=new MessageChannel,t=new MessageChannel,n=wt("../dataWorker.js","dataWebWorker");n.postMessage({action:"connectToCanvasWorker"},[e.port1]),n.postMessage({action:"connectToClassifierWorker"},[t.port1]),Se(n);var a=wt("../canvasWorker.js","CanvasWebWorker");a.postMessage({action:"connectToDataWorker"},[e.port2]),Pe(a);var r=wt("../classifierWorker.js","classifierWebWorker");r.postMessage({action:"connectToDataWorker"},[t.port2]),Ie(r)}),[]);var wt=function(e,t){var n=new Worker(e);return n.addEventListener("error",(function(e){console.log("["+t+"] Error",e.message,e)})),n},kt=B(),Ct=(0,b.Z)(((e={})[kt.buttonSuccess]=me,e)),Zt=function(e){i(null),null!=e&&Tt(e)},Pt=function(){var e=(0,r.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("open big picture"),console.log(t),st(!0),ft("Image: "+t.ImageNumber+", Object: "+t.ObjectNumber),e.abrupt("return",xt(Ze,"get",{getType:"blobUrlBigPictureFromCellPair",getArgs:{cellPair:t}}).then((function(e){gt(e.data.blobUrl)})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Tt=function(){var e=(0,r.Z)(l().mark((function e(t){var n,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Fetch!"),!(void 0===t|null==t)){e.next=3;break}return e.abrupt("return");case 3:ve(!0),G({unclassified:[],positive:[],negative:[]}),n=[],e.t0=t,e.next="Random"===e.t0?10:"Positive"===e.t0||"Negative"===e.t0?12:"Confusing"===e.t0?15:"ImageNumber"===e.t0?18:"TrainingPositive"===e.t0||"TrainingNegative"===e.t0?22:28;break;case 10:return xt(Ne,"get",{getType:"cellPairs",getArgs:{amount:16}}).then((function(e){var t=e.data.getResult;return n=t,He(t),console.log(t),xt(Ze,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return console.log("tile state time"),Wt(e.data.blobUrls,n)})).then((function(e){G(e),ve(!1)})),e.abrupt("break",28);case 12:return n=null,xt(Ne,"get",{getType:"cellPairs",getArgs:{amount:100}}).then((function(e){var n=e.data.getResult;return xt(je,"predictFilterCellPairs",{cellPairs:n,classType:t})})).then((function(e){var t=e.data.filteredCellPairs,a=t.slice(0,16);return n=t,He(t),xt(Ze,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:a}})})).then((function(e){return Wt(e.data.blobUrls,n)})).then((function(e){G(e),ve(!1)})),e.abrupt("break",28);case 15:return n=null,xt(Ne,"get",{getType:"cellPairs",getArgs:{amount:100}}).then((function(e){var t=e.data.getResult;return xt(je,"confusingFilterCellPairs",{cellPairs:t})})).then((function(e){var t=e.data.sortedCellPairs.slice(0,16);return He(t),n=t,xt(Ze,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return Wt(e.data.blobUrls,n)})).then((function(e){G(e),ve(!1)})),e.abrupt("break",28);case 18:return n=null,console.log("fetch by image number: "+tt),xt(Ne,"get",{getType:"cellPairsFromImage",getArgs:{ImageNumber:tt}}).then((function(e){var n=e.data.getResult;return console.log(n),xt(je,"predictFilterCellPairs",{cellPairs:n,classType:t})})).then((function(e){var t=e.data.filteredCellPairs,a=t.slice(0,16);return He(t),n=t,xt(Ze,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:a}})})).then((function(e){return Wt(e.data.blobUrls,n)})).then((function(e){G(e),ve(!1)})),e.abrupt("break",28);case 22:return n=null,console.log("Enter fetch: "+t),a=Oe.trainingData.map((function(e){return{ImageNumber:e[0],ObjectNumber:e[1]}})),console.log(a),xt(je,"predictFilterCellPairs",{cellPairs:a,classType:"TrainingPositive"===t?"Positive":"Negative"}).then((function(e){console.log("Return from predictFilterCellPairs ",e.data);var t=e.data.filteredCellPairs;return He(t),n=t,xt(Ze,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return console.log("Return get blobUrlsFromCellPairs",e.data),Wt(e.data.blobUrls,n)})).then((function(e){G(e),ve(!1)})),e.abrupt("break",28);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nt=function(){var e=(0,r.Z)(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Train!"),t=$.positive.map((function(e){return Ue[e.id]})),n=$.negative.map((function(e){return Ue[e.id]})),r=t.concat(n),i=new Array(t.length).fill(1).concat(new Array(n.length).fill(0)),$e(!1),G({unclassified:[],positive:[],negative:[]}),He([]),xt(Ne,"get",{getType:"objectRowsFromCellpairs",getArgs:{cellPairs:r}}).then((function(e){var t=e.data.getResult,n={classifierType:"LogisticRegression",trainingData:[].concat((0,a.Z)(Oe.trainingData),(0,a.Z)(t)),trainingLabels:[].concat((0,a.Z)(Oe.trainingLabels),(0,a.Z)(i)),featureIndicesToUse:Oe.featureIndicesToUse};return St(n)}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),St=function(e){ke(!0);var t=null,n=function(e){if(t==e.data.uuid)switch(e.data.action){case"updateTrainingCanvases":M.show.history(Ve.current,e.data.trainLogs,[].concat((0,a.Z)(e.data.ticks.loss),(0,a.Z)(e.data.ticks.accuracy)));break;default:console.log("didn't render bad action")}};xt(je,"startTrainingGraphsConnection",{}).then((function(a){return t=a.data.uuid,je.addEventListener("message",n),xt(je,"train",{trainingObject:e})})).then((function(){return xt(je,"endTrainingGraphsConnection",{}),je.removeEventListener("message",n),xt(je,"confusionMatrix")})).then((function(e){var t=e.data.confusionMatrix;We(t)})).then((function(){De(e),ke(!1)}))},xt=function(e,t,n){var a=(0,A.Z)();return new Promise((function(r){e.addEventListener("message",(function t(n){n.data.uuid===a&&(e.removeEventListener("message",t),r(n))})),e.postMessage(Object.assign({action:t},n,{uuid:a}))}))},jt=function(){var e=(0,r.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Upload!"),ue(!0),xt(Ne,"init",{fileListObject:t.target.files}).then((function(){console.log("done"),xt(Ne,"get",{getType:"cellPairData",getArgs:{cellPair:{ImageNumber:1,ObjectNumber:1}}})})).then((function(){return console.log("next"),xt(Ne,"get",{getType:"trainingObject"})})).then((function(e){var t=e.data.getResult;return St(t)})).then((function(){ue(!1),de(!0),q(!0),Q(!0),ae(!0),ee(!0),le(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),It=function(e,t){void 0===t&&(t=null);var n="";return null!==t&&(n+=t.join(",")+"\n"),n+=e.map((function(e){return e.join(",")})).join("\n")},Rt=function(){var e=(0,r.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Score All!"),ze||vt){e.next=5;break}return ht(!0),console.log("Score All!"),e.abrupt("return",xt(je,"scoreObjectData").then((function(e){var t=e.data.scoreTableObject;console.log(t);var n=Object.keys(t.imageToCountsMap).map((function(e){return{imageNumber:e,total:t.imageToCountsMap[e][0]+t.imageToCountsMap[e][1],positive:t.imageToCountsMap[e][1],negative:t.imageToCountsMap[e][0],ratio:t.ratios[e],adjustratio:t.adjustedRatios[e]}})),a=Object.values(t.adjustedRatios).map((function(e){return{x:e}}));Qe(a),qe(n),ht(!1);var r=n.map((function(e){return[e.imageNumber,e.positive,e.negative,e.total,e.ratio,e.adjustratio]})),i=It(r,["ImageNumber","PositiveCount","NegativeCount","TotalCount","Ratio","AdjustedRatio"]);yt(i),$e(!0)})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),At=function(){var e=(0,r.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Download!"),e.abrupt("return",xt(je,"getClassifier").then((function(e){H.FBF("indexeddb://"+Oe.classifierType).then((function(e){e.save("downloads://"+Oe.classifierType)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function Wt(e,t){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,r.Z)(l().mark((function e(t,n){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return xt(Ne,"get",{getType:"cellPairData",getArgs:{cellPair:e}}).then((function(e){return e.data.getResult}))})));case 2:return a=e.sent,e.abrupt("return",{unclassified:t.map((function(e,t){var n=a[t],r="Ob: "+n.ObjectNumber+"\nIm: "+n.ImageNumber;return console.log(r),{id:t,address:e,info:r,cellPair:{ImageNumber:n.ImageNumber,ObjectNumber:n.ObjectNumber}}})),positive:[],negative:[]});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ot=function(){Ee(!1),Zt("ImageNumber")};return o.createElement(D.d,{onChange:function(e,t,n,a){var r;if(a){var i,l=(0,F.p)($[e],$[a],t,n);return G(Object.assign({},$,((i={})[e]=l[0],i[a]=l[1],i)))}var o=(0,O.L)($[e],t,n);return G(Object.assign({},$,((r={})[e]=o,r)))}},o.createElement("div",{style:{overflowX:"hidden",height:"100%",width:"100%"}},o.createElement(s.Z,{style:{marginTop:"2%"}},o.createElement(v.Z,{src:p.Z,style:{marginLeft:"11%",height:"30%",width:"25%",position:"relative",maxHeight:"125px",marginBottom:"2%"}}),o.createElement(c.Z,{style:{left:"40%",right:5}},o.createElement("div",{className:kt.root},o.createElement("div",{className:kt.wrapper},o.createElement(j.ZP,{title:"Load Data","aria-label":"load data"},o.createElement(k.Z,{"aria-label":"save",color:"primary",component:"label",className:Ct,style:{marginRight:5}},me?o.createElement(C.Z,null):o.createElement(Z.Z,null),o.createElement("input",{type:"file",hidden:!0,webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",multiple:!0,onChange:function(e){jt(e)},disabled:!ie}))),ce&&o.createElement(y.Z,{className:kt.fabProgress,size:68})))),o.createElement(c.Z,{style:{left:"15%"}},o.createElement(j.ZP,{title:"Download","aria-label":"download"},o.createElement(k.Z,{"aria-label":"save",color:"primary",component:"label",disabled:!ne,onClick:At,style:{positive:"relative"}}," ",o.createElement(h.Z,null))))),o.createElement(s.Z,null,o.createElement(u.Z,{container:!0,justify:"center",spacing:2,style:{marginBottom:15}},o.createElement(u.Z,{key:0,item:!0},o.createElement(g.Z,{disabled:!X,variant:"contained","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)}},"Fetch"),o.createElement(m.Z,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:function(){return Zt(null)}},o.createElement(d.Z,{onClick:function(){return Zt("Random")}},"Random"),o.createElement(d.Z,{onClick:function(){return Zt("Positive")}},"Positive"),o.createElement(d.Z,{onClick:function(){return Zt("Negative")}},"Negative"),o.createElement(d.Z,{onClick:function(){i(null),Ee(!0)}},"By Image"),o.createElement(d.Z,{onClick:function(){return Zt("TrainingPositive")}},"Training Set Positive"),o.createElement(d.Z,{onClick:function(){return Zt("TrainingNegative")}},"Training Set Negative"),o.createElement(d.Z,{onClick:function(){return Zt("Confusing")}},"Confusing"),o.createElement(P.Z,{open:be,onClose:function(){return Zt(null)}},o.createElement(x.Z,null,"Fetch By Image"),o.createElement(N.Z,null,o.createElement(S.Z,null,"Select the image number you would like to fetch from."),o.createElement(T.Z,null,o.createElement(f.Z,{onChange:function(e){null!==e.target.value&&void 0!==e.target.value&&""!==e.target.value&&(e.preventDefault(),console.log(e),nt(e.target.value),it(!0))},onSubmit:function(e){e.preventDefault(),Ot(),console.log("what submit")},type:"number",label:"Image Number"}),o.createElement(g.Z,{disabled:!rt,onClick:Ot,color:"primary",type:"submit"},"Ok")))))),o.createElement(u.Z,{key:1,item:!0},o.createElement(g.Z,{disabled:!K,variant:"contained",onClick:Nt},"Train"),o.createElement(P.Z,{fullWidth:500,open:we},o.createElement(x.Z,null,"Training the Classifier"),o.createElement(N.Z,null,o.createElement("div",{width:300,ref:Ye}),o.createElement("div",{width:300,ref:Ve})))),o.createElement(u.Z,{key:2,item:!0},Y?o.createElement(I.default,{confusionMatrix:Ae}):o.createElement(g.Z,{disabled:!Y,variant:"contained",onClick:function(){}},"Evaluate")),o.createElement(u.Z,{key:3,item:!0},Y?o.createElement(R.default,{histogramData:Ke,scoreTable:Xe,handleScoreAll:Rt,scoreTableIsUpToDate:ze,scoreTableCsvString:Et}):o.createElement(g.Z,{disabled:!Y,variant:"contained",onClick:Rt},"Score All")))),o.createElement("div",null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"10%",marginBottom:"0.5%",userSelect:"none"}},"Unclassified"," "),o.createElement("div",null,o.createElement(L.$,{className:"dropzone ",id:"unclassified",boxesPerRow:8,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150,marginBottom:10,marginLeft:"10%",width:"80%"}},pe?o.createElement(y.Z,{style:{height:"6vw",width:"6vw",marginTop:"6%",marginLeft:"45%"}}):$.unclassified.map((function(e){return o.createElement(U.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:120,maxWidth:120,padding:10},key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Pt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))}))),o.createElement(P.Z,{style:{alignItems:"center"},onClose:function(){console.log("close big picture"),st(!1)},open:ot},o.createElement(x.Z,null,dt),o.createElement(N.Z,{style:{alignItems:"center",justifyContent:"center"}},o.createElement("img",{width:430,height:430,src:ut})))),o.createElement(s.Z,null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"11%",userSelect:"none",marginBottom:"0.5%",marginTop:0}},"Positive"),o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingRight:"8%",userSelect:"none",margin:"auto",marginBottom:"0.5%",marginTop:0}},"Negative")),o.createElement(s.Z,null,o.createElement(L.$,{className:"dropzone positive",id:"positive",boxesPerRow:4,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150}},$.positive.map((function(e){return o.createElement(U.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:105,maxWidth:105,padding:10},key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Pt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))}))),o.createElement(L.$,{className:"dropzone negative",id:"negative",boxesPerRow:4,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150}},$.negative.map((function(e){return o.createElement(U.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:105,maxWidth:105,padding:10},key:e.address},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Pt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))})))))))}}}]);
//# sourceMappingURL=component---src-pages-web-workers-mvp-demo-js-10e09f544e871c5f28a4.js.map
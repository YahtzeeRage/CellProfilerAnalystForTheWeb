(self.webpackChunkgatsby_test=self.webpackChunkgatsby_test||[]).push([[2720],{29311:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var r=n(92137),i=n(87757),a=n.n(i),s=function(){function e(e){void 0===e&&(e={box_dim:{x:40,y:40},image_type:"object",cords:{}}),this.box_dim=e.box_dim,this.image_type=e.image_type,this.cords=e.cords,this.canvases={}}var t=e.prototype;return t.brighten=function(e,t){for(var n=t.getImageData(0,0,e.height,e.width),r=n.data,i=["red","green","blue"],a=[15,15,0],s=[-1,-1,-1],o=[256,256,256],l=[[],[],[]],c=0;c<i.length;c++)l[i[c]]=[];for(c=0;c<r.length;c+=4)for(var u=0;u<i.length;u++){var p=r[c+u];s[u]=s[u]<p?p:s[u],o[u]=o[u]>p?p:o[u],p>a[u]&&l[u].push(c+u)}var m=-1;for(c=0;c<3;c++)s[c]>m&&(m=s[c]);for(c=0;c<i.length;c++){var f=l[c];for(u=0;u<f.length;u++)r[f[u]]=r[f[u]]/m*255}t.putImageData(new ImageData(r,n.width,n.height),0,0)},t.getDataURL=function(e){"image"===this.image_type&&(this.box_dim.x=e[0].image.width,this.box_dim.y=e[0].image.height);var t=document.createElement("canvas");t.width=this.box_dim.h,t.height=this.box_dim.l;for(var n=t.getContext("2d"),r=0;r<e.length;r++){var i=e[r].color,a=document.createElement("canvas");this.canvases[i]=a}for(r=0;r<e.length;r++){i=e[r].color.toString();this.createColorCanvas(e[r].image,i)}n.globalCompositeOperation="lighter";for(r=0;r<e.length;r++){var s=e[r];"whole"===this.image_type&&n.drawImage(this.canvases[s.color],0,0),n.drawImage(this.canvases[s.color],this.cords.x,this.cords.y,this.box_dim.x,this.box_dim.y,0,0,t.width,t.height)}return n.globalCompositeOperation="source-over",this.brighten(t,n),t.toDataURL()},t.createColorCanvas=function(e,t){var n=e.height,r=e.width;this.canvases[t].width=r,this.canvases[t].height=n;var i=this.canvases[t].getContext("2d");i.globalCompositeOperation="source-over",i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=t,i.fillRect(0,0,r,n),i.globalCompositeOperation="source-over"},e}(),o=n(13967),l=function(){function e(e,t){this.getObjsToURLs=function(){var e=(0,r.Z)(a().mark((function e(t){var n,r,i,o,l,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0;case 2:if(!(r<t.length)){e.next=18;break}return i=t[r].ImageNumber,o=[],i.toString(),e.next=8,this.getImagefromFile(i);case 8:return o=e.sent,l=this.data_provider.getCordsforCellDisplay(t[r]),c=new s({cords:l}),e.next=13,c.getDataURL(o);case 13:u=e.sent,n.push(u);case 15:r++,e.next=2;break;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.getImgUrl=function(){var e=(0,r.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getImagesfromFile(t),r=new s({image_type:"whole"}),e.abrupt("return",r.getDataUrl(n));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.getImagefromFile=function(){var e=(0,r.Z)(a().mark((function e(t){var n,r,i,s=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),n=this.data_provider.returnAllImgFileNames(t),e.next=4,Promise.all(n.map((function(e){var t=s.file_handler.findFile(e.filename);return s.file_handler.fileReaderPromiseImage(t).then((function(e){return s.makeImage(e)}))})));case 4:for(r=e.sent,[],i=0;i<r.length;i++)delete n.filename,n[i].image=r[i];return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.file_handler=new o.Z(e),this.data_provider=t}return e.prototype.makeImage=function(e){var t=new Image;return t.src=e,t},e}()},69012:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(85061),i=n(92137),a=n(87757),s=n.n(a),o=n(67294),l=n(96667),c=n(47798),u=n(23729),p=n(80838),m=n(83332),f=n(44005),g=n(90058),h=n(91666),d=n(80633),v=n(79312),b=n(54179),_=function(){function e(e){var t=this;this.findFile=function(e){var n=Array.from(t.fileListObject.target.files).findIndex((function(t){return e.startsWith(".")?t.name.endsWith(e):t.name===e}));return-1===n?-1:t.fileListObject.target.files[n]},this.fileReaderPromiseText=function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.readAsText(e)}))},this.fileListObject=e}var t=e.prototype;return t.findAllFiles=function(e){var t=this;return e.map((function(e){return t.findFile(e)}))},t.fileReaderPromiseImage=function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.readAsDataURL(e)}))},e}(),y=function(){function e(){this.all_prop_keys=[["db_sql_file"],["image_table","object_table"],["training_set"],["image_id","object_id","plate_id","well_id","cell_x_loc","cell_y_loc"],["image_channel_paths","image_channel_files","image_channel_names","image_channel_colors"],["classifier_ignore_columns"],["object_name","plate_type"],["image_tile_size"]],this.prop_types=["setup","data_file_props","training_file_props","column_props","image_props","classifier_props","meta","tile_size"],this.props={}}var t=e.prototype;return t.init=function(e){for(var t=0;t<this.all_prop_keys.length;t++){this.props[this.prop_types[t]]={};for(var n=0;n<this.all_prop_keys[t].length;n++){var r;if(Array.isArray(this.all_prop_keys[t])){r=this.all_prop_keys[t][n];var i=e.indexOf(r)}else{r=this.all_prop_keys[t];i=e.indexOf(this.all_prop_keys[t])}if(-1!==i){for(i+=r.length;" "===e[i]||"="===e[i];)i++;for(var a=[],s=e[i],o=i;"\n"!==e[i];)" "!==e[i-1]||o===i?(" "!==e[i]&&","!==e[i]&&o!==i&&(s=s.concat(e[i])),i++):(a.push(s),s=e[i],i++);0===a.length?this.props[this.prop_types[t]][this.all_prop_keys[t][n]]=s:(a.push(s),this.props[this.prop_types[t]][this.all_prop_keys[t][n]]=a)}else this.props[this.prop_types[t]][this.all_prop_keys[t][n]]=-1}}},t.setupFileProperties=function(){return this.props.setup.db_sql_file},t.dataFileProperties=function(){return Object.assign(this.props.data_file_props)},t.trainingSetProperties=function(){return this.props.training_file_props.training_set},t.classifierProperties=function(){},t.imageProperties=function(){return{tile_size:this.props.tile_size,image_props:this.props.image.props}},e}();var w=n(38889),x=n(4339),k=function(){function e(e){this.getProperties=(0,i.Z)(s().mark((function e(){var t,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getFile(".properties"),console.log(t),e.abrupt("return",this.getText(t).then((function(e){var t=new y;t.init(e),n.props=t})));case 3:case"end":return e.stop()}}),e,this)}))),this.getDataProvider=(0,i.Z)(s().mark((function e(){var t,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},n=null,console.log("test"),e.abrupt("return",this.getProperties().then((function(){var e=r.getFile(r.props.setupFileProperties());return n=r.props.dataFileProperties(),console.log("test"),r.getText(e)})).then((function(e){var i=r.getColumnLines(e);for(var a in n)t[a]={},t[a].columns=i[a],console.log("test"),t[a].file=r.getFile(n[a].concat(".csv"))})).then((function(){var e=0;return Promise.all(Object.keys(t).map((function(n){return t[n].index=e++,r.getText(t[n].file)})))})).then((function(e){for(var n in t)t[n].data=e[t[n].index];return new w.Z(t,r.props)})));case 4:case"end":return e.stop()}}),e,this)}))),this.getTrainingSet=(0,i.Z)(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(t=this.props.trainingSetProperties())){e.next=3;break}return e.abrupt("return",-1);case 3:return n=this.getFile(t),e.abrupt("return",this.getText(n).then((function(e){return new x.Z(e.slice(1),"label ImageNumber ObjectNumber x y".split(" "))})));case 5:case"end":return e.stop()}}),e,this)}))),this.fileListObject=e,this.props=null}var t=e.prototype;return t.getFile=function(e){return{name:e,file:new _(this.fileListObject).findFile(e)}},t.getText=function(e){return e.name.endsWith(".csv")||e.name.endsWith(".txt")?(new b.Z).papaTextfromCSV(e):new _(this.fileListObject).fileReaderPromiseText(e.file)},t.getColumnLines=function(e){var t,n,r,i,a,s={object_table:["CREATE TABLE per_object (","PRIMARY KEY  (ImageNumber,ObjectNumber)"],image_table:["CREATE TABLE per_image (","PRIMARY KEY  (ImageNumber)"]},o={},l=e.split("\n").map((function(e){return e.trim()}));for(var c in s)if(s.hasOwnProperty(c)){var u=(t=l,n=s[c][0],r=s[c][1],i=void 0,a=void 0,i=t.indexOf(n),a=t.indexOf(r),-1===n||-1===r?(console.error("Values not found to slice"),null):t.slice(i,a));o[c]=u.map((function(e){return e.split(" ")[0]})).slice(1)}return o},e}(),E=n(22019),Z=(n(37107),n(39331)),C=n(29311),P=n(59274),I=n(31261),N=n(8441),O=n(96531),R=n(48498);var j=function(){var e,t=o.useState(null),n=t[0],a=t[1],b=o.useState(null),_=b[0],y=(b[1],o.useState(null)),w=y[0],x=y[1],j=o.useState(null),T=j[0],S=j[1],L=o.useState(me([])),F=L[0],A=L[1],D=o.useState(null),B=D[0],U=D[1],z=o.useState(null),$=(z[0],z[1]),W=o.useState(null),Y=W[0],H=(W[1],o.useState(!1)),M=H[0],q=H[1],K=o.useState(!1),V=K[0],G=K[1],J=o.useState(!1),Q=J[0],X=(J[1],o.useState(!1)),ee=X[0],te=X[1],ne=o.useState(!0),re=ne[0],ie=ne[1],ae=function(e){a(null),void 0!==e&&le(e)},se=function(){q(!1),G(!1),te(!1)},oe=function(){q(!0),G(!0),te(!0)},le=function(){var e=(0,i.Z)(s().mark((function e(t){var n,r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se(),console.time("fetch with stupid dumb way thats deff not faster because Iknow everything since I had four semesters of cs"),A({unclassified:[],positive:[],negative:[]}),n=new E.$(_,w),e.next=7,n.initTrainPromise();case 7:return $(t),r=n.fetchUpToNCellPairsByClass(t,20),n.fetchUpToNCellPairsByClass(t,20),i=new C.z(T,_),e.next=13,i.getObjsToURLs(r);case 13:return a=e.sent,o=me(a),A(o),U(new Z.e(r,a)),oe(),console.timeEnd("fetch with stupid dumb way thats deff not faster because Iknow everything since I had four semesters of cs"),e.abrupt("return");case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=(0,i.Z)(s().mark((function e(){var t,n,i,a,o,l,c,u,p,m,f,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se(),t=F.negative.map((function(e){return e.id})),n=F.positive.map((function(e){return e.id})),console.log(t,F),B.setClassByIndexArray("negative",t),B.setClassByIndexArray("positive",n),i=B.getPairsByClass("negative"),a=B.getPairsByClass("positive"),o=i.map((function(e){return _.getRow("object_data",{ImageNumber:e.ImageNumber,ObjectNumber:e.ObjectNumber})})),l=a.map((function(e){return _.getRow("object_data",{ImageNumber:e.ImageNumber,ObjectNumber:e.ObjectNumber})})),c=[].concat((0,r.Z)(o),(0,r.Z)(l)),u=new Array(o.length).fill(0),p=new Array(l.length).fill(1),m=u.concat(p),f={classifierType:"LogisticRegression",trainingData:[].concat((0,r.Z)(c),(0,r.Z)(w.trainingData)),trainingLabels:[].concat((0,r.Z)(m),(0,r.Z)(w.trainingLabels)),featuresToUse:Y},console.log(f),x(f),g={unclassified:F.unclassified,positive:[],negative:[]},A(g),console.log("finished train"),oe();case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=(0,i.Z)(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie(!1),S(t),n=new k(t),e.next=5,n.getDataProvider();case 5:return r=e.sent,e.next=8,n.getTrainingSet();case 8:i=e.sent,console.log(r),console.log(i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=(0,i.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se(),t=new E.$(_,w),e.next=4,t.initTrainPromise();case 4:t.userDownloadClassifierSpecPromise(),oe();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function me(e){return{unclassified:e.map((function(e,t){return{id:t,address:e}})),positive:[],negative:[]}}return o.createElement("div",{style:{resize:"horizontal"}},o.createElement(l.Z,null,o.createElement(c.Z,null,o.createElement(d.Z,{src:h.Z,style:{marginRight:"40%",height:"90px"}})),o.createElement(c.Z,null,o.createElement(u.Z,{style:{color:"black",marginLeft:"50%"}}," ",o.createElement(v.Z,null)))),o.createElement(N.d,{onChange:function(e,t,n,r){var i;if(r){var a,s=(0,P.p)(F[e],F[r],t,n);return A(Object.assign({},F,((a={})[e]=s[0],a[r]=s[1],a)))}var o=(0,I.L)(F[e],t,n);return A(Object.assign({},F,((i={})[e]=o,i)))}},o.createElement(l.Z,null,o.createElement(p.Z,{container:!0,justify:"center",spacing:2,style:{marginBottom:15}},o.createElement(p.Z,{key:0,item:!0},o.createElement(m.Z,{disabled:!M,variant:"contained","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){a(e.currentTarget)}},"Fetch"),o.createElement(f.Z,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:ae},o.createElement(g.Z,{onClick:function(){return ae("random")}},"Random"),o.createElement(g.Z,{onClick:function(){return ae("positive")}},"Positive"),o.createElement(g.Z,{onClick:function(){return ae("negative")}},"Negative"))),o.createElement(p.Z,{key:1,item:!0},o.createElement(m.Z,{disabled:!V,variant:"contained",onClick:ce},"Train")),o.createElement(p.Z,{key:2,item:!0},o.createElement(m.Z,{disabled:!Q,variant:"contained",onClick:function(){}},"Evaluate")),o.createElement(p.Z,{key:3,item:!0},o.createElement(m.Z,{disabled:!ee,variant:"contained",onClick:pe},"Download")),o.createElement(p.Z,{key:4,item:!0},o.createElement(m.Z,{disabled:!re,variant:"contained",component:"label",onClick:function(){return console.log("Upload!")}},"Upload",o.createElement("input",{type:"file",hidden:!0,webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",multiple:!0,onChange:function(e){ue(e)}}))))),o.createElement("div",null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"10%",marginBottom:.5}},"Unclassified"),o.createElement("div",{className:"topContainer"},o.createElement(O.$,{className:"dropzone ",id:"unclassified",boxesPerRow:8,rowHeight:70},F.unclassified.map((function(e){return o.createElement(R.P,{key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))})))),o.createElement(l.Z,null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"11%",userSelect:"none",marginBottom:"0.5%"}},"Positive"),o.createElement("label",{style:(e={textAlign:"left",backgroundColor:"white",paddingRight:"8%",marginBottom:0,userSelect:"none",margin:"auto"},e.marginBottom="0.5%",e)},"Negative")),o.createElement(l.Z,null,o.createElement(O.$,{className:"dropzone positive",id:"positive",boxesPerRow:4,rowHeight:70},F.positive.map((function(e){return o.createElement(R.P,{key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))}))),o.createElement(O.$,{className:"dropzone negative",id:"negative",boxesPerRow:4,rowHeight:70},F.negative.map((function(e){return o.createElement(R.P,{key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))})))))))}}}]);
//# sourceMappingURL=component---src-pages-index-img-prov-2-js-2bc8a0ea3b7220d97999.js.map
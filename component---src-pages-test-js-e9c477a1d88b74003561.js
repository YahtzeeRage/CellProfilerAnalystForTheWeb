(self.webpackChunkgatsby_test=self.webpackChunkgatsby_test||[]).push([[1672],{13508:function(e,t,n){"use strict";var a=n(95318),r=n(20862);t.Z=void 0;var i=r(n(67294)),l=(0,a(n(58786)).default)(i.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");t.Z=l},20235:function(e,t,n){"use strict";n.r(t);var a=n(85061),r=n(92137),i=n(87757),l=n.n(i),o=n(67294),s=n(96667),c=n(47798),u=n(80838),g=n(83332),m=n(44005),d=n(90058),f=n(1097),p=n(20458),v=n(80633),h=n(79312),b=n(85505),E=n(10920),y=n(27136),k=n(51474),w=n(49995),Z=n(13508),C=n(54657),P=n(4513),T=n(89952),N=n(65733),S=n(32253),x=n(9901),j=n(31690),I=n(77447),R=n(88816),A=n(14195),W=n(9789),L=n(17710),F=n(59274),O=n(31261),U=n(8441),M=n(96531),D=n(48498),H=n(67253),B=n(74243),z=(n(74298),(0,E.Z)((function(e){return{root:{display:"flex",alignItems:"center"},wrapper:{position:"relative"},buttonSuccess:{backgroundColor:k.Z[500],"&:hover":{backgroundColor:k.Z[700]}},fabProgress:{color:k.Z[500],position:"absolute",top:-6,left:-6,zIndex:1},buttonProgress:{color:k.Z[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}})));t.default=function(){var e,t=o.useState(null),n=t[0],i=t[1],E=o.useState(null),k=(E[0],E[1],o.useState(null)),$=(k[0],k[1],o.useState({unclassified:[],positive:[],negative:[]})),G=$[0],_=$[1],V=o.useState(!1),X=V[0],q=V[1],J=o.useState(!1),K=J[0],Q=J[1],Y=o.useState(!1),ee=Y[0],te=Y[1],ne=o.useState(!1),ae=ne[0],re=ne[1],ie=o.useState(!0),le=ie[0],oe=ie[1],se=o.useState(!1),ce=(se[0],se[1],o.useState(!1)),ue=ce[0],ge=ce[1],me=o.useState(!1),de=me[0],fe=me[1],pe=o.useState(!1),ve=pe[0],he=pe[1],be=o.useState(!1),Ee=be[0],ye=be[1],ke=o.useState(!1),we=ke[0],Ze=ke[1],Ce=o.useState(null),Pe=Ce[0],Te=Ce[1],Ne=o.useState(null),Se=Ne[0],xe=Ne[1],je=o.useState(null),Ie=je[0],Re=je[1],Ae=o.useState([[0,0],[0,0]]),We=Ae[0],Le=Ae[1],Fe=o.useState(null),Oe=Fe[0],Ue=Fe[1],Me=o.useState([]),De=Me[0],He=Me[1],Be=o.useState([]),ze=(Be[0],Be[1],o.useState(!1)),$e=ze[0],Ge=ze[1],_e=o.useState(null),Ve=(_e[0],_e[1],o.useState([])),Xe=Ve[0],qe=Ve[1],Je=o.useState([]),Ke=Je[0],Qe=Je[1],Ye=o.useRef(),et=o.useRef(),tt=o.useState(0),nt=tt[0],at=tt[1],rt=o.useState(!1),it=rt[0],lt=rt[1],ot=o.useState(!1),st=ot[0],ct=ot[1],ut=o.useState(L.Z),gt=ut[0],mt=ut[1],dt=o.useState(""),ft=dt[0],pt=dt[1],vt=o.useState(!1),ht=vt[0],bt=vt[1],Et=o.useState(""),yt=Et[0],kt=Et[1];o.useEffect((function(){var e=new MessageChannel,t=new MessageChannel,n=wt("../dataWorker2.js","dataWebWorker");n.postMessage({action:"connectToCanvasWorker"},[e.port1]),n.postMessage({action:"connectToClassifierWorker"},[t.port1]),xe(n);var a=wt("../canvasWorker.js","CanvasWebWorker");a.postMessage({action:"connectToDataWorker"},[e.port2]),Te(a);var r=wt("../classifierWorker.js","classifierWebWorker");r.postMessage({action:"connectToDataWorker"},[t.port2]),Re(r)}),[]);var wt=function(e,t){var n=new Worker(e);return n.addEventListener("error",(function(e){console.log("["+t+"] Error",e.message,e)})),n},Zt=z(),Ct=(0,b.Z)(((e={})[Zt.buttonSuccess]=de,e)),Pt=function(e){i(null),null!=e&&Nt(e)},Tt=function(){var e=(0,r.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("open big picture"),console.log(t),ct(!0),pt("Image: "+t.ImageNumber+", Object: "+t.ObjectNumber),e.abrupt("return",jt(Pe,"get",{getType:"blobUrlBigPictureFromCellPair",getArgs:{cellPair:t}}).then((function(e){mt(e.data.blobUrl)})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nt=function(){var e=(0,r.Z)(l().mark((function e(t){var n,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Fetch!"),!(void 0===t|null==t)){e.next=3;break}return e.abrupt("return");case 3:he(!0),_({unclassified:[],positive:[],negative:[]}),n=[],e.t0=t,e.next="Random"===e.t0?10:"Positive"===e.t0||"Negative"===e.t0?12:"Confusing"===e.t0?15:"ImageNumber"===e.t0?18:"TrainingPositive"===e.t0||"TrainingNegative"===e.t0?22:28;break;case 10:return jt(Se,"get",{getType:"cellPairs",getArgs:{amount:16}}).then((function(e){var t=e.data.getResult;return n=t,He(t),console.log(t),jt(Pe,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return console.log("tile state time"),Lt(e.data.blobUrls,n)})).then((function(e){_(e),he(!1)})),e.abrupt("break",28);case 12:return n=null,jt(Se,"get",{getType:"cellPairs",getArgs:{amount:100}}).then((function(e){var n=e.data.getResult;return jt(Ie,"predictFilterCellPairs",{cellPairs:n,classType:t})})).then((function(e){var t=e.data.filteredCellPairs,a=t.slice(0,16);return n=t,He(t),jt(Pe,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:a}})})).then((function(e){return Lt(e.data.blobUrls,n)})).then((function(e){_(e),he(!1)})),e.abrupt("break",28);case 15:return n=null,jt(Se,"get",{getType:"cellPairs",getArgs:{amount:100}}).then((function(e){var t=e.data.getResult;return jt(Ie,"confusingFilterCellPairs",{cellPairs:t})})).then((function(e){var t=e.data.sortedCellPairs.slice(0,16);return He(t),n=t,jt(Pe,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return Lt(e.data.blobUrls,n)})).then((function(e){_(e),he(!1)})),e.abrupt("break",28);case 18:return n=null,console.log("fetch by image number: "+nt),jt(Se,"get",{getType:"cellPairsFromImage",getArgs:{ImageNumber:nt}}).then((function(e){var n=e.data.getResult;return console.log(n),jt(Ie,"predictFilterCellPairs",{cellPairs:n,classType:t})})).then((function(e){var t=e.data.filteredCellPairs,a=t.slice(0,16);return He(t),n=t,jt(Pe,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:a}})})).then((function(e){return Lt(e.data.blobUrls,n)})).then((function(e){_(e),he(!1)})),e.abrupt("break",28);case 22:return n=null,console.log("Enter fetch: "+t),a=Oe.trainingData.map((function(e){return{ImageNumber:e[0],ObjectNumber:e[1]}})),console.log(a),jt(Ie,"predictFilterCellPairs",{cellPairs:a,classType:"TrainingPositive"===t?"Positive":"Negative"}).then((function(e){console.log("Return from predictFilterCellPairs ",e.data);var t=e.data.filteredCellPairs;return He(t),n=t,jt(Pe,"get",{getType:"blobUrlsFromCellPairs",getArgs:{cellPairs:t}})})).then((function(e){return console.log("Return get blobUrlsFromCellPairs",e.data),Lt(e.data.blobUrls,n)})).then((function(e){_(e),he(!1)})),e.abrupt("break",28);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),St=function(){var e=(0,r.Z)(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Train!"),t=G.positive.map((function(e){return De[e.id]})),n=G.negative.map((function(e){return De[e.id]})),r=t.concat(n),i=new Array(t.length).fill(1).concat(new Array(n.length).fill(0)),Ge(!1),_({unclassified:[],positive:[],negative:[]}),He([]),jt(Se,"get",{getType:"objectRowsFromCellpairs",getArgs:{cellPairs:r}}).then((function(e){var t=e.data.getResult,n={classifierType:"LogisticRegression",trainingData:[].concat((0,a.Z)(Oe.trainingData),(0,a.Z)(t)),trainingLabels:[].concat((0,a.Z)(Oe.trainingLabels),(0,a.Z)(i)),featureIndicesToUse:Oe.featureIndicesToUse};return xt(n)}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xt=function(e){Ze(!0);var t=null,n=function(e){if(t==e.data.uuid)switch(e.data.action){case"updateTrainingCanvases":B.show.history(Ye.current,e.data.trainLogs,[].concat((0,a.Z)(e.data.ticks.loss),(0,a.Z)(e.data.ticks.accuracy)));break;default:console.log("didn't render bad action")}};jt(Ie,"startTrainingGraphsConnection",{}).then((function(a){return t=a.data.uuid,Ie.addEventListener("message",n),jt(Ie,"train",{trainingObject:e})})).then((function(){return jt(Ie,"endTrainingGraphsConnection",{}),Ie.removeEventListener("message",n),jt(Ie,"confusionMatrix")})).then((function(e){var t=e.data.confusionMatrix;Le(t)})).then((function(){Ue(e),Ze(!1)}))},jt=function(e,t,n){var a=(0,W.Z)();return new Promise((function(r){e.addEventListener("message",(function t(n){n.data.uuid===a&&(e.removeEventListener("message",t),r(n))})),e.postMessage(Object.assign({action:t},n,{uuid:a}))}))},It=function(){var e=(0,r.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Upload!"),ge(!0),jt(Se,"init",{fileListObject:t.target.files}).then((function(){console.log("done"),jt(Se,"get",{getType:"cellPairData",getArgs:{cellPair:{ImageNumber:1,ObjectNumber:1}}})})).then((function(){return console.log("next"),jt(Se,"get",{getType:"trainingObject"})})).then((function(e){var t=e.data.getResult;return xt(t)})).then((function(){ge(!1),fe(!0),q(!0),Q(!0),re(!0),te(!0),oe(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Rt=function(e,t){void 0===t&&(t=null);var n="";return null!==t&&(n+=t.join(",")+"\n"),n+=e.map((function(e){return e.join(",")})).join("\n")},At=function(){var e=(0,r.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Score All!"),$e||ht){e.next=5;break}return bt(!0),console.log("Score All!"),e.abrupt("return",jt(Ie,"scoreObjectData").then((function(e){var t=e.data.scoreTableObject;console.log(t);var n=Object.keys(t.imageToCountsMap).map((function(e){return{imageNumber:e,total:t.imageToCountsMap[e][0]+t.imageToCountsMap[e][1],positive:t.imageToCountsMap[e][1],negative:t.imageToCountsMap[e][0],ratio:t.ratios[e],adjustratio:t.adjustedRatios[e]}})),a=Object.values(t.adjustedRatios).map((function(e){return{x:e}}));Qe(a),qe(n),bt(!1);var r=n.map((function(e){return[e.imageNumber,e.positive,e.negative,e.total,e.ratio,e.adjustratio]})),i=Rt(r,["ImageNumber","PositiveCount","NegativeCount","TotalCount","Ratio","AdjustedRatio"]);kt(i),Ge(!0)})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Wt=function(){var e=(0,r.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Download!"),e.abrupt("return",jt(Ie,"getClassifier").then((function(e){H.FBF("indexeddb://"+Oe.classifierType).then((function(e){e.save("downloads://"+Oe.classifierType)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function Lt(e,t){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,r.Z)(l().mark((function e(t,n){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return jt(Se,"get",{getType:"cellPairData",getArgs:{cellPair:e}}).then((function(e){return e.data.getResult}))})));case 2:return a=e.sent,e.abrupt("return",{unclassified:t.map((function(e,t){var n=a[t],r="Ob: "+n.ObjectNumber+"\nIm: "+n.ImageNumber;return console.log(r),{id:t,address:e,info:r,cellPair:{ImageNumber:n.ImageNumber,ObjectNumber:n.ObjectNumber}}})),positive:[],negative:[]});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return o.createElement(U.d,{onChange:function(e,t,n,a){var r;if(a){var i,l=(0,F.p)(G[e],G[a],t,n);return _(Object.assign({},G,((i={})[e]=l[0],i[a]=l[1],i)))}var o=(0,O.L)(G[e],t,n);return _(Object.assign({},G,((r={})[e]=o,r)))}},o.createElement("div",{style:{overflowX:"hidden",height:"100%",width:"100%"}},o.createElement(s.Z,{style:{marginTop:"2%"}},o.createElement(v.Z,{src:p.Z,style:{marginLeft:"11%",height:"30%",width:"25%",position:"relative",maxHeight:"125px",marginBottom:"2%"}}),o.createElement(c.Z,{style:{left:"40%",right:5}},o.createElement("div",{className:Zt.root},o.createElement("div",{className:Zt.wrapper},o.createElement(I.ZP,{title:"Load Data","aria-label":"load data"},o.createElement(w.Z,{"aria-label":"save",color:"primary",component:"label",className:Ct,style:{marginRight:5}},de?o.createElement(Z.Z,null):o.createElement(C.Z,null),o.createElement("input",{type:"file",hidden:!0,webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",multiple:!0,onChange:function(e){It(e)},disabled:!le}))),ue&&o.createElement(y.Z,{className:Zt.fabProgress,size:68})))),o.createElement(c.Z,{style:{left:"15%"}},o.createElement(I.ZP,{title:"Download","aria-label":"download"},o.createElement(w.Z,{"aria-label":"save",color:"primary",component:"label",disabled:!ae,onClick:Wt,style:{positive:"relative"}}," ",o.createElement(h.Z,null))))),o.createElement(s.Z,null,o.createElement(u.Z,{container:!0,justify:"center",spacing:2,style:{marginBottom:15}},o.createElement(u.Z,{key:0,item:!0},o.createElement(g.Z,{disabled:!X,variant:"contained","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)}},"Fetch"),o.createElement(m.Z,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:function(){return Pt(null)}},o.createElement(d.Z,{onClick:function(){return Pt("Random")}},"Random"),o.createElement(d.Z,{onClick:function(){return Pt("Positive")}},"Positive"),o.createElement(d.Z,{onClick:function(){return Pt("Negative")}},"Negative"),o.createElement(d.Z,{onClick:function(){i(null),ye(!0)}},"By Image"),o.createElement(d.Z,{onClick:function(){return Pt("TrainingPositive")}},"Training Set Positive"),o.createElement(d.Z,{onClick:function(){return Pt("TrainingNegative")}},"Training Set Negative"),o.createElement(d.Z,{onClick:function(){return Pt("Confusing")}},"Confusing"),o.createElement(P.Z,{open:Ee,onClose:function(){return Pt(null)}},o.createElement(x.Z,null,"Fetch By Image"),o.createElement(N.Z,null,o.createElement(S.Z,null,"Select the image number you would like to fetch from."),o.createElement("form",{noValidate:!0},o.createElement(j.Z,null,o.createElement(f.Z,{onChange:function(e){null!==e.target.value&&void 0!==e.target.value&&""!==e.target.value&&(at(e.target.value),lt(!0))},type:"number",label:"Image Number"})))),o.createElement(T.Z,null,o.createElement(g.Z,{disabled:!it,onClick:function(){ye(!1),Pt("ImageNumber")},color:"primary"},"Ok"))))),o.createElement(u.Z,{key:1,item:!0},o.createElement(g.Z,{disabled:!K,variant:"contained",onClick:St},"Train"),o.createElement(P.Z,{fullWidth:500,open:we},o.createElement(x.Z,null,"Training the Classifier"),o.createElement(N.Z,null,o.createElement("div",{width:300,ref:et}),o.createElement("div",{width:300,ref:Ye})))),o.createElement(u.Z,{key:2,item:!0},ee?o.createElement(R.default,{confusionMatrix:We}):o.createElement(g.Z,{disabled:!ee,variant:"contained",onClick:function(){}},"Evaluate")),o.createElement(u.Z,{key:3,item:!0},ee?o.createElement(A.default,{histogramData:Ke,scoreTable:Xe,handleScoreAll:At,scoreTableIsUpToDate:$e,scoreTableCsvString:yt}):o.createElement(g.Z,{disabled:!ee,variant:"contained",onClick:At},"Score All")))),o.createElement("div",null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"10%",marginBottom:"0.5%",userSelect:"none"}},"Unclassified"," "),o.createElement("div",null,o.createElement(M.$,{className:"dropzone ",id:"unclassified",boxesPerRow:8,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150,marginBottom:10,marginLeft:"10%",width:"80%"}},ve?o.createElement(y.Z,{style:{height:"6vw",width:"6vw",marginTop:"6%",marginLeft:"45%"}}):G.unclassified.map((function(e){return o.createElement(D.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:120,maxWidth:120,padding:10},key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Tt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))}))),o.createElement(P.Z,{style:{alignItems:"center"},onClose:function(){console.log("close big picture"),ct(!1)},open:st},o.createElement(x.Z,null,ft),o.createElement(N.Z,{style:{alignItems:"center",justifyContent:"center"}},o.createElement("img",{width:430,height:430,src:gt})))),o.createElement(s.Z,null,o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"11%",userSelect:"none",marginBottom:"0.5%",marginTop:0}},"Positive"),o.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingRight:"8%",userSelect:"none",margin:"auto",marginBottom:"0.5%",marginTop:0}},"Negative")),o.createElement(s.Z,null,o.createElement(M.$,{className:"dropzone positive",id:"positive",boxesPerRow:4,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150}},G.positive.map((function(e){return o.createElement(D.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:105,maxWidth:105,padding:10},key:e.id},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Tt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))}))),o.createElement(M.$,{className:"dropzone negative",id:"negative",boxesPerRow:4,rowHeight:80,style:{height:"20vw",maxHeight:200,minHeight:150}},G.negative.map((function(e){return o.createElement(D.P,{className:"hoverTest",style:{height:"15vw",width:"15vw",minHeight:80,minWidth:80,maxHeight:105,maxWidth:105,padding:10},key:e.address},o.createElement("div",{className:"grid-item"},o.createElement("div",{onDoubleClick:function(){console.log("double click: "+e.info),Tt(e.cellPair)},className:"grid-item-content",style:{backgroundImage:"url("+e.address+")",height:"5vw",width:"5vw"}},o.createElement("span",{className:"hoverText"},e.info))))})))))))}}}]);
//# sourceMappingURL=component---src-pages-test-js-e9c477a1d88b74003561.js.map
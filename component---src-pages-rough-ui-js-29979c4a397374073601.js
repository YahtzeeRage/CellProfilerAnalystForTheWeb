(self.webpackChunkgatsby_test=self.webpackChunkgatsby_test||[]).push([[6113],{48945:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(92137),a=n(87757),i=n.n(a),o=n(54179),l=n(13967),c=n(38889),s=n(4339),u=function(){function e(e){this.sliceArrayByValue=function(e,t,n){var r=e.indexOf(t),a=e.indexOf(n);return-1===t||-1===n?(console.error("Values not found to slice"),null):e.slice(r,a)},this.basicPapaConfig={worker:!0,skipEmptyLines:!0,dynamicTyping:!0},this.getDataHandlerandStartingTrainingSet=(0,r.Z)(i().mark((function e(){var t,n,r,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return["column_lines","object_data","image_data","training_data"],[],t=this.getFiles(),e.next=5,this.getText(t);case 5:return n=e.sent,r=this.getColumnLines(n[0]),a=new c.Z({object_data:n[1],image_data:n[2],object_columns:r[0],image_columns:r[1]}),o=new s.Z(n[3].slice(1),r[2]),e.abrupt("return",{data_provider:a,training_data:{features:r[0],training_table:o}});case 10:case"end":return e.stop()}}),e,this)}))),this.fileListObject=e}var t=e.prototype;return t.getFiles=function(){var e=new l.Z(this.fileListObject);return["example_SETUP.SQL","per_object.csv","per_image.csv","MyTrainingSet.txt"].map((function(t){return{file:e.findFile(t),name:t}}))},t.getText=function(e){var t=this;return Promise.all(e.map((function(e){if(e.name.endsWith(".csv")||e.name.endsWith(".txt"))return(new o.Z).papaTextfromCSV(e);var n=new l.Z(t.fileListObject);return console.log(e),n.fileReaderPromiseText(e.file)})))},t.getColumnLines=function(e){var t=[],n=e.split("\n").map((function(e){return e.trim()})),r=this.sliceArrayByValue(n,"CREATE TABLE per_object (","PRIMARY KEY  (ImageNumber,ObjectNumber)");t.push(r.map((function(e){return e.split(" ")[0]})).slice(1));var a=this.sliceArrayByValue(n,"CREATE TABLE per_image (","PRIMARY KEY  (ImageNumber)");return t.push(a.map((function(e){return e.split(" ")[0]})).slice(1)),t.push("label imagenum objectnum x y".split(" ")),t},e}()},40880:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var r=n(85061),a=n(92137),i=n(87757),o=n.n(i),l=n(67294),c=n(96667),s=n(47798),u=n(23729),m=n(80838),g=n(83332),f=n(44005),d=n(90058),p=n(91666),v=n(80633),b=n(79312),h=n(48945),y=n(22019),E=n(67253),w=function(){function e(){}var t=e.prototype;return t.getDataURLPromise=function(e,t){var n=this;return void 0===t&&(t={}),Promise.all(e).then((function(e){return Promise.all(e.map((function(e){return n.createRGB(e)})))})).then((function(e){return E.knu(e,2).squeeze()})).then((function(e){return n.createDataURL(e,t)}))},t.createDataURL=function(e,t){var n=document.createElement("canvas");n.width=500,n.height=600;var r=n.getContext("2d"),a=document.createElement("canvas");return E.Xhn.toPixels(e,a).then((function(){return t.hasOwnProperty("x")&&t.hasOwnProperty("x"),r.drawImage(a,t.x,t.y,40,40,0,0,n.width,n.height),a.remove(),n.toDataURL()}))},t.createRGB=function(e){return new Promise((function(t,n){var r,a=new Image;a.onload=function(){r=E.Xhn.fromPixels(a,1),t(r)},a.src=e}))},e}(),Z=n(13967),P=(n(37107),n(39331)),k=n(59274),x=n(31261),C=n(8441),N=n(96531),R=n(48498);var L=function(){var e,t=l.useState(null),n=t[0],i=t[1],E=l.useState(null),L=E[0],I=E[1],_=l.useState(null),j=_[0],T=_[1],A=l.useState(null),S=A[0],B=A[1],D=l.useState(J([])),O=D[0],U=D[1],F=l.useState(null),z=F[0],H=F[1],V=l.useState(null),$=(V[0],V[1]),M=l.useState(null),Y=M[0],G=M[1],K=function(e){i(null),void 0!==e&&W(e)},W=function(){var e=(0,a.Z)(o().mark((function e(t){var n,r,a,i,l,c,s,u,m,g,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.$(L,j),e.next=3,n.initTrainPromise();case 3:if($(t),console.log("fetch "+t),r=n.fetchUpToNCellPairsByClass(t,20),a=new w,i=null,"random"!==t){e.next=19;break}return l=r.map((function(e){var t=L.returnAllImgFileNames(e.ImageNumber).map((function(e){return S.findFile(e)})).map((function(e){return S.fileReaderPromiseImage(e)}));return Promise.all(t).then((function(t){var n=L.getCordsforCellDisplay(e);return a.getDataURLPromise(t,n)}))})),e.next=12,Promise.all(l);case 12:return c=e.sent,s=J(c),U(s),console.log(s),console.log(c),H(new P.e(r,c)),e.abrupt("return");case 19:if("positive"!==t){e.next=30;break}return i=r.map((function(e){var t=L.returnAllImgFileNames(e.ImageNumber).map((function(e){return S.findFile(e)})).map((function(e){return S.fileReaderPromiseImage(e)}));return Promise.all(t).then((function(t){var n=L.getCordsforCellDisplay(e);return a.getDataURLPromise(t,n)}))})),e.next=23,Promise.all(i);case 23:return u=e.sent,m=J(u),U(m),console.log(m),console.log(u),H(new P.e(r,u)),e.abrupt("return");case 30:if("negative"!==t){e.next=41;break}return i=r.map((function(e){var t=L.returnAllImgFileNames(e.ImageNumber).map((function(e){return S.findFile(e)})).map((function(e){return S.fileReaderPromiseImage(e)}));return Promise.all(t).then((function(t){var n=L.getCordsforCellDisplay(e);return a.getDataURLPromise(t,n)}))})),e.next=34,Promise.all(i);case 34:return g=e.sent,f=J(g),U(f),console.log(f),console.log(g),H(new P.e(r,g)),e.abrupt("return");case 41:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=(0,a.Z)(o().mark((function e(){var t,n,a,i,l,c,s,u,m,g,f,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=O.negative.map((function(e){return e.id})),n=O.positive.map((function(e){return e.id})),console.log(t,O),z.setClassByIndexArray("negative",t),z.setClassByIndexArray("positive",n),a=z.getPairsByClass("negative"),i=z.getPairsByClass("positive"),l=a.map((function(e){return L.getRow("object_data",{ImageNumber:e.ImageNumber,ObjectNumber:e.ObjectNumber})})),c=i.map((function(e){return L.getRow("object_data",{ImageNumber:e.ImageNumber,ObjectNumber:e.ObjectNumber})})),s=[].concat((0,r.Z)(l),(0,r.Z)(c)),u=new Array(l.length).fill(0),m=new Array(c.length).fill(1),g=u.concat(m),f={classifierType:"LogisticRegression",trainingData:[].concat((0,r.Z)(s),(0,r.Z)(j.trainingData)),trainingLabels:[].concat((0,r.Z)(g),(0,r.Z)(j.trainingLabels)),featuresToUse:Y},console.log(f),T(f),d={unclassified:O.unclassified,positive:[],negative:[]},U(d),console.log("finished train");case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=(0,a.Z)(o().mark((function e(t){var n,r,a,i,l,c,s,u,m,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Z.Z(t),B(n),r=new h.Z(t),e.next=5,r.getDataHandlerandStartingTrainingSet();case 5:a=e.sent,i=a.data_provider,I(i),l=a.training_data.training_table,c=l.getDataColumnsPaired(),s=l.getTrainingLabels(),u=c.map((function(e){var t=e.objectnum,n=e.imagenum;return i.getRow("object_data",{ObjectNumber:t,ImageNumber:n})})),m=a.training_data.features,g=m.filter((function(e){return!e.includes("Location")&&"ObjectNumber"!==e&&"ImageNumber"!==e})),G(g),console.log("finished data initialization"),T({classifierType:"LogisticRegression",trainingData:u,trainingLabels:s,featuresToUse:g}),console.log("finished upload");case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=(0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new y.$(L,j),e.next=3,t.initTrainPromise();case 3:t.userDownloadClassifierSpecPromise();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function J(e){return{unclassified:e.map((function(e,t){return{id:t,address:e}})),positive:[],negative:[]}}return l.createElement("div",{style:{resize:"horizontal"}},l.createElement(c.Z,null,l.createElement(s.Z,null,l.createElement(v.Z,{src:p.Z,style:{marginRight:"40%",height:"90px"}})),l.createElement(s.Z,null,l.createElement(u.Z,{style:{color:"black",marginLeft:"50%"}}," ",l.createElement(b.Z,null)))),l.createElement(c.Z,null,l.createElement(m.Z,{container:!0,justify:"center",spacing:2,style:{marginBottom:15}},l.createElement(m.Z,{key:0,item:!0},l.createElement(g.Z,{variant:"contained","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)}},"Fetch"),l.createElement(f.Z,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:K},l.createElement(d.Z,{onClick:function(){return K("random")}},"Random"),l.createElement(d.Z,{onClick:function(){return K("positive")}},"Positive"),l.createElement(d.Z,{onClick:function(){return K("negative")}},"Negative"))),l.createElement(m.Z,{key:1,item:!0},l.createElement(g.Z,{variant:"contained",onClick:X},"Train")),l.createElement(m.Z,{key:2,item:!0},l.createElement(g.Z,{variant:"contained",onClick:function(){}},"Evaluate")),l.createElement(m.Z,{key:3,item:!0},l.createElement(g.Z,{variant:"contained",onClick:Q},"Download")),l.createElement(m.Z,{key:4,item:!0},l.createElement(g.Z,{variant:"contained",component:"label",onClick:function(){return console.log("Upload!")}},"Upload",l.createElement("input",{type:"file",hidden:!0,webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",multiple:!0,onChange:function(e){q(e)}}))))),l.createElement(C.d,{onChange:function(e,t,n,r){var a;if(r){var i,o=(0,k.p)(O[e],O[r],t,n);return U(Object.assign({},O,((i={})[e]=o[0],i[r]=o[1],i)))}var l=(0,x.L)(O[e],t,n);return U(Object.assign({},O,((a={})[e]=l,a)))}},l.createElement("div",null,l.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"10%",marginBottom:.5}},"Unclassified"),l.createElement("div",{className:"topContainer"},l.createElement(N.$,{className:"dropzone ",id:"unclassified",boxesPerRow:8,rowHeight:70},O.unclassified.map((function(e){return l.createElement(R.P,{key:e.id},l.createElement("div",{className:"grid-item"},l.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))})))),l.createElement(c.Z,null,l.createElement("label",{style:{textAlign:"left",backgroundColor:"white",paddingLeft:"11%",userSelect:"none",marginBottom:"0.5%"}},"Positive"),l.createElement("label",{style:(e={textAlign:"left",backgroundColor:"white",paddingRight:"8%",marginBottom:0,userSelect:"none",margin:"auto"},e.marginBottom="0.5%",e)},"Negative")),l.createElement(c.Z,null,l.createElement(N.$,{className:"dropzone positive",id:"positive",boxesPerRow:4,rowHeight:70},O.positive.map((function(e){return l.createElement(R.P,{key:e.id},l.createElement("div",{className:"grid-item"},l.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))}))),l.createElement(N.$,{className:"dropzone negative",id:"negative",boxesPerRow:4,rowHeight:70},O.negative.map((function(e){return l.createElement(R.P,{key:e.id},l.createElement("div",{className:"grid-item"},l.createElement("div",{className:"grid-item-content",style:{backgroundImage:"url("+e.address+")"}})))})))))))}}}]);
//# sourceMappingURL=component---src-pages-rough-ui-js-29979c4a397374073601.js.map